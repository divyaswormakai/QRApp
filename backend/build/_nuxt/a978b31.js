(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1227:function(e,o,t){"use strict";t.r(o);var n=t(26),r=t(1199),c=(t(113),t(114),t(140),t(297),t(202),t(89),t(79),t(88),t(37),t(66),t(64),t(77),t(644),t(22)),l=t(1225),d={name:"schoolIndex",middleware:["adminAuth"],mounted:function(){this.getSchoolList()},data:function(){return{schoolList:[],columns:c.f,visibleAddForm:!1,confirmLoading:!1,form:this.$form.createForm(this,{name:"school-list-form"}),visibleEditForm:!1,editForm:this.$form.createForm(this,{name:"editSchoolForm"}),activeSchoolID:"",baseURL:c.a,fileList:[],excelFileList:[]}},methods:{downloadCSV:function(){var e="data:text/csv;charset=utf-8,";e+=[["S.No.","School Name","School Location","School Email","School Contact"].join(",")].concat(Object(r.a)(this.schoolList.map((function(e,o){return[o+1,e.schoolName,e.schoolLocation,e.schoolEmail,e.schoolContact].join(",")})))).join("\n").replace(/(^\[)|(\]$)/gm,"");var data=encodeURI(e),link=document.createElement("a");link.setAttribute("href",data),link.setAttribute("download","schools.csv"),link.click()},getSchoolList:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function o(){var t;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.$axios.post("/admin/school");case 3:if(t=o.sent,Array.isArray(null==t?void 0:t.data)){o.next=7;break}return e.$message.error("Could not load school data"),o.abrupt("return");case 7:e.schoolList=null==t?void 0:t.data,o.next=13;break;case 10:o.prev=10,o.t0=o.catch(0),e.$message.error("Could not fetch school list.");case 13:case"end":return o.stop()}}),o,null,[[0,10]])})))()},showAddFormModal:function(){this.visibleAddForm=!0},handleSchoolAddition:function(e){var o=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.confirmLoading=!0,e.next=3,o.form.validateFields(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(t,n){var r,c,d,m,data,h,f,v,w;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=39;break}return r="",e.next=4,Object(l.a)(o.excelFileList[0],{getSheets:!0});case 4:c=e.sent,console.log(c),e.t0=regeneratorRuntime.keys(c);case 7:if((e.t1=e.t0()).done){e.next=23;break}return d=e.t1.value,m=c[d],e.next=12,Object(l.a)(o.excelFileList[0],{sheet:m.name});case 12:data=e.sent,e.t2=regeneratorRuntime.keys(data);case 14:if((e.t3=e.t2()).done){e.next=21;break}if(h=e.t3.value,"Room"!==data[h][0]){e.next=18;break}return e.abrupt("continue",14);case 18:r+="".concat(m.name," - ").concat(data[h][0],","),e.next=14;break;case 21:e.next=7;break;case 23:return r=r.slice(0,r.length-1),f=o.form.getFieldsValue(),(v=new FormData).append("schoolName",f.schoolName),v.append("schoolLocation",f.schoolLocation),v.append("schoolContact",f.schoolContact),v.append("schoolEmail",f.schoolEmail),v.append("password",f.password),v.append("logo",o.fileList[0]),v.append("classRoomList",r),e.next=35,o.$axios.post("admin/school/add",v);case 35:200===(null==(w=e.sent)?void 0:w.status)?(o.schoolList.push(null==w?void 0:w.data),o.form.resetFields(),o.$message.success("Successfully added new school."),o.visibleAddForm=!1):o.$message.error("Could not add new school."),e.next=40;break;case 39:o.$message.error("Please input correct values");case 40:o.confirmLoading=!1;case 41:case"end":return e.stop()}}),e)})));return function(o,t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})))()},handleCancel:function(e){this.visibleAddForm=!1,this.visibleEditForm=!1,this.confirmLoading=!1},editSchoolAction:function(e){var o=this;this.visibleEditForm=!0,Object.keys(e).forEach((function(t){o.editForm.getFieldDecorator(t,{initialValue:e[t]})})),this.activeSchoolID=null==e?void 0:e.id},handleSchoolUpdate:function(e){var o=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.confirmLoading=!0,t=o.editForm.getFieldsValue(),e.next=4,o.editForm.validateFields(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=7;break}return e.next=3,o.$axios.put("admin/school/"+o.activeSchoolID,t);case 3:200===(null==(r=e.sent)?void 0:r.status)?(o.schoolList=o.schoolList.map((function(e){return e.id===o.activeSchoolID?null==r?void 0:r.data:e})),o.editForm.resetFields(),o.activeSchoolID="",o.$message.success("Successfully updated School:"+(null==t?void 0:t.schoolName)),o.visibleEditForm=!1):o.$message.error("Could not update school."),e.next=8;break;case 7:o.$message.error("Please input correct values");case 8:o.confirmLoading=!1;case 9:case"end":return e.stop()}}),e)})));return function(o){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})))()},handleRemove:function(e){var o=this.fileList.indexOf(e),t=this.fileList.slice();t.splice(o,1),this.fileList=t},beforeUpload:function(e){return this.fileList=[e],!1},handleRemoveExcel:function(e){var o=this.excelFileList.indexOf(e),t=this.excelFileList.slice();t.splice(o,1),this.excelFileList=t},beforeUploadExcel:function(e){return this.excelFileList=[e],!1}}},m=t(87),component=Object(m.a)(d,(function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("h1",[e._v("School List")]),e._v(" "),t("a-button",{attrs:{type:"primary"},on:{click:e.showAddFormModal}},[e._v("\n        Add a new school\n      ")]),e._v(" "),t("a-modal",{attrs:{title:"Add details of the new school",visible:e.visibleAddForm,"confirm-loading":e.confirmLoading},on:{ok:e.handleSchoolAddition,cancel:e.handleCancel}},[t("a-form",{attrs:{form:e.form}},[t("a-form-item",{attrs:{label:"Name of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolName",{rules:[{required:!0,message:"School Name can't be empty"}]}],expression:"[\n              'schoolName',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Name can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Password for the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:4,message:"School Password should be at least 4 letters."}]}],expression:"[\n              'password',\n              {\n                rules: [\n                  {\n                    required: true,\n                    min: 4,\n                    message: 'School Password should be at least 4 letters.',\n                  },\n                ],\n              },\n            ]"}],attrs:{type:"password"}})],1),e._v(" "),t("a-form-item",{attrs:{label:"Location of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolLocation",{rules:[{required:!0,message:"School Location can't be empty"}]}],expression:"[\n              'schoolLocation',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Location can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Email of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolEmail",{rules:[{required:!0,message:"School Email can't be empty"}]}],expression:"[\n              'schoolEmail',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Email can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Contact Number of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolContact",{rules:[{required:!0,message:"School Contact can't be empty"}]}],expression:"[\n              'schoolContact',\n              {\n                rules: [\n                  { required: true, message: 'School Contact can\\'t be empty' },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"File for ClassRoom"}},[t("a-upload",{attrs:{"file-list":e.excelFileList,remove:e.handleRemoveExcel,"before-upload":e.beforeUploadExcel,multiple:!1}},[t("a-button",[t("a-icon",{attrs:{type:"upload"}}),e._v(" Select Excel File ")],1)],1)],1),e._v(" "),t("a-form-item",{attrs:{label:"School Logo"}},[t("a-upload",{attrs:{"file-list":e.fileList,remove:e.handleRemove,"before-upload":e.beforeUpload,multiple:!1}},[t("a-button",[t("a-icon",{attrs:{type:"upload"}}),e._v(" Select Logo ")],1)],1)],1)],1)],1),e._v(" "),t("a-button",{on:{click:function(o){return e.downloadCSV()}}},[e._v("Download CSV")]),e._v(" "),t("a-table",{attrs:{columns:e.columns,"data-source":e.schoolList,scroll:{x:1200},rowKey:function(e){return e.id}},scopedSlots:e._u([{key:"logo",fn:function(text,o){return t("img",{attrs:{src:e.baseURL+o.logoURL,alt:"Logo",width:"100",height:"100"}})}},{key:"schoolName",fn:function(text,o){return t("a",{attrs:{href:"/school/"+o.id}},[e._v(e._s(text))])}},{key:"action",fn:function(text,o){return t("span",{},[t("a-button",{attrs:{type:"primary"},on:{click:function(t){return e.editSchoolAction(o)}}},[e._v("Edit")])],1)}}])}),e._v(" "),t("a-modal",{attrs:{title:"Edit Details for the school",visible:e.visibleEditForm,"confirm-loading":e.confirmLoading},on:{ok:e.handleSchoolUpdate,cancel:e.handleCancel}},[t("a-form",{attrs:{form:e.editForm}},[t("a-form-item",{attrs:{label:"Name of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolName",{rules:[{required:!0,message:"School Name can't be empty"}]}],expression:"[\n              'schoolName',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Name can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Password for the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:4,message:"School Password should be at least 4 letters."}]}],expression:"[\n              'password',\n              {\n                rules: [\n                  {\n                    required: true,\n                    min: 4,\n                    message: 'School Password should be at least 4 letters.',\n                  },\n                ],\n              },\n            ]"}],attrs:{type:"password",default:"",placeholder:"Put the old password if you don't want to change password"}})],1),e._v(" "),t("a-form-item",{attrs:{label:"Location of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolLocation",{rules:[{required:!0,message:"School Location can't be empty"}]}],expression:"[\n              'schoolLocation',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Location can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Email of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolEmail",{rules:[{required:!0,message:"school Email can't be empty"}]}],expression:"[\n              'schoolEmail',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'school Email can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),t("a-form-item",{attrs:{label:"Contact Number of the school"}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolContact",{rules:[{required:!0,message:"School Contact can't be empty"}]}],expression:"[\n              'schoolContact',\n              {\n                rules: [\n                  { required: true, message: 'School Contact can\\'t be empty' },\n                ],\n              },\n            ]"}]})],1)],1)],1)],1)}),[],!1,null,"1c03325c",null);o.default=component.exports}}]);