(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1227:function(e,t,o){"use strict";o.r(t);var n=o(26),r=o(1199),l=(o(113),o(114),o(140),o(297),o(202),o(89),o(79),o(88),o(37),o(66),o(64),o(77),o(644),o(22)),c=o(1225),d={name:"schoolIndex",middleware:["adminAuth"],mounted:function(){this.getSchoolList()},data:function(){return{schoolList:[],columns:l.f,visibleAddForm:!1,confirmLoading:!1,form:this.$form.createForm(this,{name:"school-list-form"}),visibleEditForm:!1,editForm:this.$form.createForm(this,{name:"editSchoolForm"}),activeSchoolID:"",baseURL:l.a,fileList:[],excelFileList:[],updateFileList:[]}},methods:{downloadCSV:function(){var e="data:text/csv;charset=utf-8,";e+=[["S.No.","School Name","School Location","School Email","School Contact"].join(",")].concat(Object(r.a)(this.schoolList.map((function(e,t){return[t+1,e.schoolName,e.schoolLocation,e.schoolEmail,e.schoolContact].join(",")})))).join("\n").replace(/(^\[)|(\]$)/gm,"");var data=encodeURI(e),link=document.createElement("a");link.setAttribute("href",data),link.setAttribute("download","schools.csv"),link.click()},getSchoolList:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$axios.post("/admin/school");case 3:if(o=t.sent,Array.isArray(null==o?void 0:o.data)){t.next=7;break}return e.$message.error("Could not load school data"),t.abrupt("return");case 7:e.schoolList=null==o?void 0:o.data,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),e.$message.error("Could not fetch school list.");case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},showAddFormModal:function(){this.visibleAddForm=!0},handleSchoolAddition:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.confirmLoading=!0,e.next=3,t.form.validateFields(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(o,n){var r,l,d,m,data,h,f,v,L;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=38;break}return r="",e.next=4,Object(c.a)(t.excelFileList[0],{getSheets:!0});case 4:l=e.sent,e.t0=regeneratorRuntime.keys(l);case 6:if((e.t1=e.t0()).done){e.next=22;break}return d=e.t1.value,m=l[d],e.next=11,Object(c.a)(t.excelFileList[0],{sheet:m.name});case 11:data=e.sent,e.t2=regeneratorRuntime.keys(data);case 13:if((e.t3=e.t2()).done){e.next=20;break}if(h=e.t3.value,"Room"!==data[h][0]){e.next=17;break}return e.abrupt("continue",13);case 17:r+="".concat(m.name," - ").concat(data[h][0],","),e.next=13;break;case 20:e.next=6;break;case 22:return r=r.slice(0,r.length-1),f=t.form.getFieldsValue(),(v=new FormData).append("schoolName",f.schoolName),v.append("schoolLocation",f.schoolLocation),v.append("schoolContact",f.schoolContact),v.append("schoolEmail",f.schoolEmail),v.append("password",f.password),v.append("logo",t.fileList[0]),v.append("classRoomList",r),e.next=34,t.$axios.post("admin/school/add",v);case 34:200===(null==(L=e.sent)?void 0:L.status)?(t.schoolList.push(null==L?void 0:L.data),t.form.resetFields(),t.fileList=[],t.excelFileList=[],t.$message.success("Successfully added new school."),t.visibleAddForm=!1):t.$message.error("Could not add new school."),e.next=39;break;case 38:t.$message.error("Please input correct values");case 39:t.confirmLoading=!1;case 40:case"end":return e.stop()}}),e)})));return function(t,o){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})))()},handleCancel:function(e){this.visibleAddForm=!1,this.visibleEditForm=!1,this.confirmLoading=!1},editSchoolAction:function(e){var t=this;this.visibleEditForm=!0,Object.keys(e).forEach((function(o){t.editForm.getFieldDecorator(o,{initialValue:e[o]})})),this.activeSchoolID=null==e?void 0:e.id},handleSchoolUpdate:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.confirmLoading=!0,o=t.editForm.getFieldsValue(),e.next=4,t.editForm.validateFields(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(n){var r,l,d,m,data,h,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=31;break}return r="",e.next=4,Object(c.a)(t.updateFileList[0],{getSheets:!0});case 4:l=e.sent,e.t0=regeneratorRuntime.keys(l);case 6:if((e.t1=e.t0()).done){e.next=22;break}return d=e.t1.value,m=l[d],e.next=11,Object(c.a)(t.updateFileList[0],{sheet:m.name});case 11:data=e.sent,e.t2=regeneratorRuntime.keys(data);case 13:if((e.t3=e.t2()).done){e.next=20;break}if(h=e.t3.value,"Room"!==data[h][0]){e.next=17;break}return e.abrupt("continue",13);case 17:r+="".concat(m.name," - ").concat(data[h][0],","),e.next=13;break;case 20:e.next=6;break;case 22:return r=r.slice(0,r.length-1),(f=t.editForm.getFieldsValue()).classRoomList=r,e.next=27,t.$axios.put("admin/school/"+t.activeSchoolID,f);case 27:200===(null==(v=e.sent)?void 0:v.status)?(t.schoolList=t.schoolList.map((function(e){return e.id===t.activeSchoolID?null==v?void 0:v.data:e})),t.editForm.resetFields(),t.updateFileList=[],t.activeSchoolID="",t.$message.success("Successfully updated School:"+(null==o?void 0:o.schoolName)),t.visibleEditForm=!1):t.$message.error("Could not update school."),e.next=32;break;case 31:t.$message.error("Please input correct values");case 32:t.confirmLoading=!1;case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})))()},handleRemove:function(e){var t=this.fileList.indexOf(e),o=this.fileList.slice();o.splice(t,1),this.fileList=o},beforeUpload:function(e){return this.fileList=[e],!1},handleRemoveExcel:function(e){var t=this.excelFileList.indexOf(e),o=this.excelFileList.slice();o.splice(t,1),this.excelFileList=o},beforeUploadExcel:function(e){return this.excelFileList=[e],!1},handleRemoveUpdate:function(e){var t=this.updateFileList.indexOf(e),o=this.updateFileList.slice();o.splice(t,1),this.updateFileList=o},beforeUploadUpdate:function(e){return this.updateFileList=[e],!1}}},m=o(87),component=Object(m.a)(d,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("h1",[e._v("School List")]),e._v(" "),o("a-button",{attrs:{type:"primary"},on:{click:e.showAddFormModal}},[e._v("\n        Add a new school\n      ")]),e._v(" "),o("a-modal",{attrs:{title:"Add details of the new school",visible:e.visibleAddForm,"confirm-loading":e.confirmLoading},on:{ok:e.handleSchoolAddition,cancel:e.handleCancel}},[o("a-form",{attrs:{form:e.form}},[o("a-form-item",{attrs:{label:"Name of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolName",{rules:[{required:!0,message:"School Name can't be empty"}]}],expression:"[\n              'schoolName',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Name can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Password for the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:4,message:"School Password should be at least 4 letters."}]}],expression:"[\n              'password',\n              {\n                rules: [\n                  {\n                    required: true,\n                    min: 4,\n                    message: 'School Password should be at least 4 letters.',\n                  },\n                ],\n              },\n            ]"}],attrs:{type:"password"}})],1),e._v(" "),o("a-form-item",{attrs:{label:"Location of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolLocation",{rules:[{required:!0,message:"School Location can't be empty"}]}],expression:"[\n              'schoolLocation',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Location can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Email of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolEmail",{rules:[{required:!0,message:"School Email can't be empty"}]}],expression:"[\n              'schoolEmail',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Email can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Contact Number of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolContact",{rules:[{required:!0,message:"School Contact can't be empty"}]}],expression:"[\n              'schoolContact',\n              {\n                rules: [\n                  { required: true, message: 'School Contact can\\'t be empty' },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"File for ClassRoom"}},[o("a-upload",{attrs:{"file-list":e.excelFileList,remove:e.handleRemoveExcel,"before-upload":e.beforeUploadExcel,multiple:!1}},[o("a-button",[o("a-icon",{attrs:{type:"upload"}}),e._v(" Select Excel File ")],1)],1)],1),e._v(" "),o("a-form-item",{attrs:{label:"School Logo"}},[o("a-upload",{attrs:{"file-list":e.fileList,remove:e.handleRemove,"before-upload":e.beforeUpload,multiple:!1}},[o("a-button",[o("a-icon",{attrs:{type:"upload"}}),e._v(" Select Logo ")],1)],1)],1)],1)],1),e._v(" "),o("a-button",{on:{click:function(t){return e.downloadCSV()}}},[e._v("Download CSV")]),e._v(" "),o("a-table",{attrs:{columns:e.columns,"data-source":e.schoolList,scroll:{x:1200},rowKey:function(e){return e.id}},scopedSlots:e._u([{key:"logo",fn:function(text,t){return o("img",{attrs:{src:e.baseURL+t.logoURL,alt:"Logo",width:"100",height:"100"}})}},{key:"schoolName",fn:function(text,t){return o("a",{attrs:{href:"/school/"+t.id}},[e._v(e._s(text))])}},{key:"action",fn:function(text,t){return o("span",{},[o("a-button",{attrs:{type:"primary"},on:{click:function(o){return e.editSchoolAction(t)}}},[e._v("Edit")])],1)}}])}),e._v(" "),o("a-modal",{attrs:{title:"Edit Details for the school",visible:e.visibleEditForm,"confirm-loading":e.confirmLoading},on:{ok:e.handleSchoolUpdate,cancel:e.handleCancel}},[o("a-form",{attrs:{form:e.editForm}},[o("a-form-item",{attrs:{label:"Name of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolName",{rules:[{required:!0,message:"School Name can't be empty"}]}],expression:"[\n              'schoolName',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Name can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Password for the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,min:4,message:"School Password should be at least 4 letters."}]}],expression:"[\n              'password',\n              {\n                rules: [\n                  {\n                    required: true,\n                    min: 4,\n                    message: 'School Password should be at least 4 letters.',\n                  },\n                ],\n              },\n            ]"}],attrs:{type:"password",default:"",placeholder:"Put the old password if you don't want to change password"}})],1),e._v(" "),o("a-form-item",{attrs:{label:"Location of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolLocation",{rules:[{required:!0,message:"School Location can't be empty"}]}],expression:"[\n              'schoolLocation',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'School Location can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Email of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolEmail",{rules:[{required:!0,message:"school Email can't be empty"}]}],expression:"[\n              'schoolEmail',\n              {\n                rules: [\n                  {\n                    required: true,\n                    message: 'school Email can\\'t be empty',\n                  },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"Contact Number of the school"}},[o("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["schoolContact",{rules:[{required:!0,message:"School Contact can't be empty"}]}],expression:"[\n              'schoolContact',\n              {\n                rules: [\n                  { required: true, message: 'School Contact can\\'t be empty' },\n                ],\n              },\n            ]"}]})],1),e._v(" "),o("a-form-item",{attrs:{label:"File for ClassRoom(Leave empty for unchanged)"}},[o("a-upload",{attrs:{"file-list":e.updateFileList,remove:e.handleRemoveUpdate,"before-upload":e.beforeUploadUpdate,multiple:!1}},[o("a-button",[o("a-icon",{attrs:{type:"upload"}}),e._v(" Select Excel File ")],1)],1)],1)],1)],1)],1)}),[],!1,null,"e076c770",null);t.default=component.exports}}]);